(function(e){e.Zebra_Tooltips=function(h,p){var q={animation_speed:200,animation_offset:10,background_color:"#000",close_on_click:!0,color:"#FFF",content:!1,hide_delay:100,keep_visible:!0,opacity:0.85,prerender:!1,show_delay:100,position:"center",onBeforeHide:null,onHide:null,onBeforeShow:null,onShow:null},b=this,i,n;b.settings={};b.hide=function(c,a){var b=c.data("Zebra_Tooltip");b&&(b.sticky=!1,a&&(b.destroy=!0),c.data("Zebra_Tooltip",b),j(c))};b.show=function(c,a){var b=c.data("Zebra_Tooltip"); b&&(b.sticky=!0,b.muted=!1,a&&(b.destroy=!0),c.data("Zebra_Tooltip",b),l(c))};var k=function(c){var a=c.data("Zebra_Tooltip");if(!a.tooltip){var d=jQuery("<div>",{"class":"Zebra_Tooltip",css:{opacity:1,display:"block"}}),f=jQuery("<div>",{"class":"Zebra_Tooltip_Message",css:{width:"auto","background-color":b.settings.background_color,color:b.settings.color}}).html(b.settings.content?b.settings.content:a.content).appendTo(d),a=jQuery("<div>",{"class":"Zebra_Tooltip_Arrow"}).appendTo(d),g=jQuery("<div>").appendTo(a); b.settings.keep_visible&&(d.bind("mouseleave"+(b.settings.close_on_click?" click":""),function(){j(c)}),d.bind("mouseenter",function(){l(c)}));d.appendTo("body");var m=d.outerWidth(),h=d.outerHeight(),k=g.outerWidth(),o=g.outerHeight(),a={tooltip:d,tooltip_width:m,tooltip_height:h+o/2,message:f,arrow_container:a,arrow_width:k,arrow_height:o,arrow:g},g=f.outerWidth(),m=f.outerHeight();d.css({width:a.tooltip_width,height:a.tooltip_height});a.tooltip_width+=f.outerWidth()-g;a.tooltip_height+=f.outerHeight()- m;d.css({width:a.tooltip_width,height:a.tooltip_height});a=e.extend(c.data("Zebra_Tooltip"),a);c.data("Zebra_Tooltip",a)}a.sticky&&!a.close&&(jQuery("<a>",{"class":"Zebra_Tooltip_Close",href:"javascript:void(0)"}).html("x").bind("click",function(a){a.preventDefault();a=c.data("Zebra_Tooltip");a.sticky=!1;c.data("Zebra_Tooltip",a);j(c)}).appendTo(a.message),a.close=!0,a=e.extend(c.data("Zebra_Tooltip"),a),c.data("Zebra_Tooltip",a));if(a.window_resized||a.window_scrolled)d=e(window),a.window_resized&& (i=d.width(),d.height(),f=c.offset(),e.extend(a,{element_left:f.left,element_top:f.top,element_width:c.outerWidth(),element_height:c.outerHeight()})),n=d.scrollTop(),d="left"==b.settings.position?a.element_left-a.tooltip_width+a.arrow_width:"right"==b.settings.position?a.element_left+a.element_width-a.arrow_width:a.element_left+(a.element_width-a.tooltip_width)/2,f=a.element_top-a.tooltip_height,g="left"==b.settings.position?a.tooltip_width-a.arrow_width-a.arrow_width/2:"right"==b.settings.position? a.arrow_width/2:(a.tooltip_width-a.arrow_width)/2,d+a.tooltip_width>i&&(g-=i-(a.tooltip_width+d)-6,d=i-a.tooltip_width-6),0>d&&(g+=d,d=2),a.arrow_container.removeClass("Zebra_Tooltip_Arrow_Top"),a.arrow_container.addClass("Zebra_Tooltip_Arrow_Bottom"),a.message.css("margin-top",""),a.arrow.css("borderColor",b.settings.background_color+" transparent transparent"),f<n&&(f=a.element_top+a.element_height,a.animation_offset=-a.animation_offset,a.message.css("margin-top",a.arrow_height/2),a.arrow_container.removeClass("Zebra_Tooltip_Arrow_Bottom"), a.arrow_container.addClass("Zebra_Tooltip_Arrow_Top"),a.arrow.css("borderColor","transparent transparent "+b.settings.background_color)),a.arrow_container.css("left",g),a.tooltip.css({left:d,top:f}),e.extend(a,{tooltip_left:d,tooltip_top:f,arrow_left:g}),a.window_resized=!1,a.window_scrolled=!1,a=e.extend(c.data("Zebra_Tooltip"),a),c.data("Zebra_Tooltip",a);return a},j=function(c){var a=c.data("Zebra_Tooltip");clearTimeout(a.hide_timeout);a.sticky||(clearTimeout(a.show_timeout),a.hide_timeout=setTimeout(function(){if(a.tooltip){if(b.settings.onBeforeHide&& "function"==typeof b.settings.onBeforeHide)b.settings.onBeforeHide(c);a.close=!1;a.destroy&&(a.muted=!0);c.data("Zebra_Tooltip",a);e("a.Zebra_Tooltip_Close",a.tooltip).remove();a.tooltip.stop();a.tooltip.animate({opacity:0,top:a.tooltip_top-a.animation_offset},b.settings.animation_speed,function(){e(this).css("display","none");if(b.settings.onHide&&typeof b.settings.onHide=="function")b.settings.onHide(c)})}},b.settings.hide_delay))},l=function(c){var a=c.data("Zebra_Tooltip");clearTimeout(a.show_timeout); a.muted||(clearTimeout(a.hide_timeout),a.show_timeout=setTimeout(function(){a=k(c);if(b.settings.onBeforeShow&&"function"==typeof b.settings.onBeforeShow)b.settings.onBeforeShow(c);"block"!=a.tooltip.css("display")&&a.tooltip.css({top:a.tooltip_top-a.animation_offset});a.tooltip.css("display","block");a.tooltip.stop();a.tooltip.animate({top:a.tooltip_top,opacity:b.settings.opacity},b.settings.animation_speed,function(){if(b.settings.onShow&&"function"==typeof b.settings.onShow)b.settings.onShow(c)})}, b.settings.show_delay))};(function(){b.settings=e.extend({},q,p);h.each(function(){var c=e(this);c.bind({mouseenter:function(){l(c)},mouseleave:function(){j(c)}});c.data("Zebra_Tooltip",{tooltip:null,content:c.attr("title")||"",window_resized:!0,window_scrolled:!0,show_timeout:null,hide_timeout:null,animation_offset:Math.abs(b.settings.animation_offset),sticky:!1,destroy:!1,muted:!1});c.attr("title","");b.settings.prerender&&k(c)});e(window).bind("scroll resize",function(b){h.each(function(){var a= e(this).data("Zebra_Tooltip");"scroll"==b.type?a.window_scrolled=!0:a.window_resized=!0;e(this).data("Zebra_Tooltip",a)})})})()}})(jQuery);
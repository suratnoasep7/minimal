(function(c){c.Zebra_DatePicker=function(F,C){var ca={always_show_clear:!1,always_visible:!1,days:"Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),direction:0,disabled_dates:!1,first_day_of_week:1,format:"Y-m-d",inside:!0,lang_clear_date:"Clear",months:"January February March April May June July August September October November December".split(" "),offset:[20,-5],pair:!1,readonly_element:!0,show_week_number:!1,start_date:!1,view:"days",weekend_days:[0,6],onSelect:null},s,l,w, x,z,D,E,G,T,R,W,n,o,u,p,i,N,H,I,S,O,q,r,P,J,L,X,Y,Z,y,a=this;a.settings={};var v=c(F),$=function(b){b||(a.settings=c.extend({},ca,C));a.settings.readonly_element&&v.attr("readonly","readonly");var d={days:["d","j"],months:["F","m","M","n","t"],years:["o","Y","y"]},h=!1,e=!1,g=!1;for(type in d)c.each(d[type],function(c,b){a.settings.format.indexOf(b)>-1&&(type=="days"?h=true:type=="months"?e=true:type=="years"&&(g=true))});y=h&&e&&g?["years","months","days"]:!h&&e&&g?["years","months"]:!h&&!e&&g?["years"]: ["years","months","days"];-1==c.inArray(a.settings.view,y)&&(a.settings.view=y[y.length-1]);var d=new Date,k=!a.settings.reference_date?d:a.settings.reference_date,f,j;r=q=void 0;n=k.getMonth();T=d.getMonth();o=k.getFullYear();R=d.getFullYear();u=k.getDate();W=d.getDate();if(!0===a.settings.direction)q=k;else if(!1===a.settings.direction)r=k,L=r.getMonth(),J=r.getFullYear(),P=r.getDate();else if(!c.isArray(a.settings.direction)&&M(a.settings.direction)&&0<m(a.settings.direction)||c.isArray(a.settings.direction)&& (!0===a.settings.direction[0]||M(a.settings.direction[0])&&0<a.settings.direction[0]||(f=Q(a.settings.direction[0])))&&(!1===a.settings.direction[1]||M(a.settings.direction[1])&&0<=a.settings.direction[1]||(j=Q(a.settings.direction[1]))))q=f?f:new Date(o,n,u+(!c.isArray(a.settings.direction)?m(a.settings.direction):m(!0===a.settings.direction[0]?0:a.settings.direction[0]))),n=q.getMonth(),o=q.getFullYear(),u=q.getDate(),j&&+j>+q?r=j:!j&&(!1!==a.settings.direction[1]&&c.isArray(a.settings.direction))&& (r=new Date(o,n,u+m(a.settings.direction[1]))),r&&(L=r.getMonth(),J=r.getFullYear(),P=r.getDate());else if(!c.isArray(a.settings.direction)&&M(a.settings.direction)&&0>m(a.settings.direction)||c.isArray(a.settings.direction)&&(!1===a.settings.direction[0]||M(a.settings.direction[0])&&0>a.settings.direction[0])&&(M(a.settings.direction[1])&&0<=a.settings.direction[1]||(f=Q(a.settings.direction[1]))))r=new Date(o,n,u+(!c.isArray(a.settings.direction)?m(a.settings.direction):m(!1===a.settings.direction[0]? 0:a.settings.direction[0]))),L=r.getMonth(),J=r.getFullYear(),P=r.getDate(),f&&+f<+r?q=f:!f&&c.isArray(a.settings.direction)&&(q=new Date(J,L,P-m(a.settings.direction[1]))),q&&(n=q.getMonth(),o=q.getFullYear(),u=q.getDate());if(q&&A(o,n,u)){for(;A(o);)q?o++:o--,n=0;for(;A(o,n);)q?n++:n--,11<n?(o++,n=0):0>n&&(o--,n=0),u=1;for(;A(o,n,u);)q?u++:u--;d=new Date(o,n,u);o=d.getFullYear();n=d.getMonth();u=d.getDate()}S=[];c.each(a.settings.disabled_dates,function(){for(var a=this.split(" "),b=0;b<4;b++){a[b]|| (a[b]="*");a[b]=a[b].indexOf(",")>-1?a[b].split(","):Array(a[b]);for(var d=0;d<a[b].length;d++)if(a[b][d].indexOf("-")>-1){var e=a[b][d].match(/^([0-9]+)\-([0-9]+)/);if(null!=e){for(var f=m(e[1]);f<=m(e[2]);f++)c.inArray(f,a[b])==-1&&a[b].push(f+"");a[b].splice(d,1)}}for(d=0;d<a[b].length;d++)a[b][d]=isNaN(m(a[b][d]))?a[b][d]:m(a[b][d])}S.push(a)});(f=Q(v.val()||(a.settings.start_date?a.settings.start_date:"")))&&A(f.getFullYear(),f.getMonth(),f.getDate())&&v.val("");b||(a.settings.always_visible|| (b='<button type="button" class="Zebra_DatePicker_Icon'+("disabled"==v.attr("disabled")?" Zebra_DatePicker_Icon_Disabled":"")+'">Pick a date</button>',w=c(b),a.icon=w,(a.settings.readonly_element?w.add(v):w).bind("click",function(b){b.preventDefault();v.attr("disabled")||(l.css("display")!="none"?a.hide():a.show())}),w.insertAfter(F),b=c(F).position(),f=c(F).outerHeight(!0),j=c(F).outerWidth(!0),icon_width=w.outerWidth(!0),icon_height=w.outerHeight(!0),a.settings.inside?(w.addClass("Zebra_DatePicker_Icon_Inside"), w.css({left:b.left+j-icon_width,top:b.top+(f-icon_height)/2})):w.css({left:b.left+j,top:b.top+(f-icon_height)/2})),b='<div class="Zebra_DatePicker"><table class="dp_header"><tr><td class="dp_previous">&laquo;</td><td class="dp_caption">&nbsp;</td><td class="dp_next">&raquo;</td></tr></table><table class="dp_daypicker"></table><table class="dp_monthpicker"></table><table class="dp_yearpicker"></table><table class="dp_footer"><tr><td>'+a.settings.lang_clear_date+"</td></tr></table></div>",l=c(b),a.datepicker= l,x=c("table.dp_header",l),z=c("table.dp_daypicker",l),D=c("table.dp_monthpicker",l),E=c("table.dp_yearpicker",l),G=c("table.dp_footer",l),a.settings.always_visible?v.attr("disabled")||(a.settings.always_visible.append(l),a.show()):c("body").append(l),l.delegate("td:not(.dp_disabled, .dp_weekend_disabled, .dp_not_in_month, .dp_blocked, .dp_week_number)","mouseover",function(){c(this).addClass("dp_hover")}).delegate("td:not(.dp_disabled, .dp_weekend_disabled, .dp_not_in_month, .dp_blocked, .dp_week_number)", "mouseout",function(){c(this).removeClass("dp_hover")}),da(c("td",x)),c(".dp_previous",x).bind("click",function(){if(!c(this).hasClass("dp_blocked")){if(s=="months")i--;else if(s=="years")i=i-12;else if(--p<0){p=11;i--}K()}}),c(".dp_caption",x).bind("click",function(){s=s=="days"?c.inArray("months",y)>-1?"months":c.inArray("years",y)>-1?"years":"days":s=="months"?c.inArray("years",y)>-1?"years":c.inArray("days",y)>-1?"days":"months":c.inArray("days",y)>-1?"days":c.inArray("months",y)>-1?"months": "years";K()}),c(".dp_next",x).bind("click",function(){if(!c(this).hasClass("dp_blocked")){if(s=="months")i++;else if(s=="years")i=i+12;else if(++p==12){p=0;i++}K()}}),z.delegate("td:not(.dp_disabled, .dp_weekend_disabled, .dp_not_in_month, .dp_week_number)","click",function(){U(i,p,m(c(this).html()),"days",c(this))}),D.delegate("td:not(.dp_disabled)","click",function(){var b=c(this).attr("class").match(/dp\_month\_([0-9]+)/);p=m(b[1]);if(c.inArray("days",y)==-1)U(i,p,1,"months",c(this));else{s="days"; a.settings.always_visible&&v.val("");K()}}),E.delegate("td:not(.dp_disabled)","click",function(){i=m(c(this).html());if(c.inArray("months",y)==-1)U(i,1,1,"years",c(this));else{s="months";a.settings.always_visible&&v.val("");K()}}),c("td",G).bind("click",function(b){b.preventDefault();v.val("");if(!a.settings.always_visible){i=p=I=H=N=null;G.css("display","none")}a.hide()}),a.settings.always_visible||c(document).bind({mousedown:a._mousedown,keyup:a._keyup}),K())};a.hide=function(){a.settings.always_visible|| (aa("hide"),l.css("display","none"))};a.show=function(){s=a.settings.view;var b=Q(v.val()||(a.settings.start_date?a.settings.start_date:""));b?(H=b.getMonth(),p=b.getMonth(),I=b.getFullYear(),i=b.getFullYear(),N=b.getDate(),A(I,H,N)&&(v.val(""),p=n,i=o)):(p=n,i=o);K();if(a.settings.always_visible)l.css("display","block");else{var b=l.outerWidth(),d=l.outerHeight(),h=w.offset().left+a.settings.offset[0],e=w.offset().top-d+a.settings.offset[1],g=c(window).width(),k=c(window).height(),f=c(window).scrollTop(), j=c(window).scrollLeft();h+b>j+g&&(h=j+g-b);h<j&&(h=j);e+d>f+k&&(e=f+k-d);e<f&&(e=f);l.css({left:h,top:e});l.fadeIn(c.browser.msie&&c.browser.version.match(/^[6-8]/)?0:150,"linear");aa()}};a.update=function(b){a.original_direction&&(a.original_direction=a.direction);a.settings=c.extend(a.settings,b);$(!0)};var Q=function(b){b+="";if(""!=c.trim(b)){for(var d=ea(a.settings.format.replace(/\s/g,"")),h="dDjlNSwFmMnYy".split(""),e=[],g=[],k=0;k<h.length;k++)-1<(position=d.indexOf(h[k]))&&e.push({character:h[k], position:position});e.sort(function(a,b){return a.position-b.position});c.each(e,function(a,b){switch(b.character){case "d":g.push("0[1-9]|[12][0-9]|3[01]");break;case "D":g.push("[a-z]{3}");break;case "j":g.push("[1-9]|[12][0-9]|3[01]");break;case "l":g.push("[a-z]+");break;case "N":g.push("[1-7]");break;case "S":g.push("st|nd|rd|th");break;case "w":g.push("[0-6]");break;case "F":g.push("[a-z]+");break;case "m":g.push("0[1-9]|1[012]+");break;case "M":g.push("[a-z]{3}");break;case "n":g.push("[1-9]|1[012]"); break;case "Y":g.push("[0-9]{4}");break;case "y":g.push("[0-9]{2}")}});if(g.length&&(e.reverse(),c.each(e,function(a,b){d=d.replace(b.character,"("+g[g.length-a-1]+")")}),g=RegExp("^"+d+"$","ig"),segments=g.exec(b.replace(/\s/g,"")))){var f,j,i,l="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),n="January February March April May June July August September October November December".split(" "),o,p=!0;e.reverse();c.each(e,function(b,d){if(!p)return!0;switch(d.character){case "m":case "n":j= m(segments[b+1]);break;case "d":case "j":f=m(segments[b+1]);break;case "D":case "l":case "F":case "M":o="D"==d.character||"l"==d.character?a.settings.days:a.settings.months;p=!1;c.each(o,function(a,c){if(p)return!0;if(segments[b+1].toLowerCase()==c.substring(0,"D"==d.character||"M"==d.character?3:c.length).toLowerCase()){switch(d.character){case "D":segments[b+1]=l[a].substring(0,3);break;case "l":segments[b+1]=l[a];break;case "F":segments[b+1]=n[a];j=a+1;break;case "M":segments[b+1]=n[a].substring(0, 3),j=a+1}p=!0}});break;case "Y":i=m(segments[b+1]);break;case "y":i="19"+m(segments[b+1])}});if(p&&(b=new Date(i,(j||1)-1,f||1),b.getFullYear()==i&&b.getDate()==(f||1)&&b.getMonth()==(j||1)-1))return b}return!1}},da=function(a){c.browser.mozilla?a.css("MozUserSelect","none"):c.browser.msie?a.bind("selectstart",function(){return!1}):a.mousedown(function(){return!1})},ea=function(a){return a.replace(/([-.*+?^${}()|[\]\/\\])/g,"\\$1")},ba=function(){var b=(new Date(i,p+1,0)).getDate(),d=(new Date(i, p,1)).getDay(),h=(new Date(i,p,0)).getDate(),d=d-a.settings.first_day_of_week,d=0>d?7+d:d;V(a.settings.months[p]+", "+i);var e="<tr>";a.settings.show_week_number&&(e+="<th>"+a.settings.show_week_number+"</th>");for(var g=0;7>g;g++)e+="<th>"+a.settings.days[(a.settings.first_day_of_week+g)%7].substr(0,2)+"</th>";e+="</tr><tr>";for(g=0;42>g;g++){0<g&&0==g%7&&(e+="</tr><tr>");if(0==g%7&&a.settings.show_week_number)var k=new Date(i,p,g),k=Math.ceil(((k-new Date(i,0,1))/864E5+k.getDay()+1)/7),e=e+('<td class="dp_week_number">'+ k+"</td>");k=g-d+1;if(g<d)e+='<td class="dp_not_in_month">'+(h-d+g+1)+"</td>";else if(k>b)e+='<td class="dp_not_in_month">'+(k-b)+"</td>";else{var f=(a.settings.first_day_of_week+g)%7,j="";A(i,p,k)?j=-1<c.inArray(f,a.settings.weekend_days)?"dp_weekend_disabled":j+" dp_disabled":(-1<c.inArray(f,a.settings.weekend_days)&&(j="dp_weekend"),p==H&&(i==I&&N==k)&&(j+=" dp_selected"),p==T&&(i==R&&W==k)&&(j+=" dp_current"));e+="<td"+(""!=j?' class="'+c.trim(j)+'"':"")+">"+t(k,2)+"</td>"}}z.html(c(e+"</tr>")); a.settings.always_visible&&(X=c("td:not(.dp_disabled, .dp_weekend_disabled, .dp_not_in_month, .dp_blocked, .dp_week_number)",z));z.css("display","")},aa=function(a){if(c.browser.msie&&c.browser.version.match(/^6/)){if(!O){var d=m(l.css("zIndex"))-1;O=jQuery("<iframe>",{src:'javascript:document.write("")',scrolling:"no",frameborder:0,allowtransparency:"true",css:{zIndex:d,position:"absolute",top:-1E3,left:-1E3,width:l.outerWidth(),height:l.outerHeight(),filter:"progid:DXImageTransform.Microsoft.Alpha(opacity=0)", display:"none"}});c("body").append(O)}switch(a){case "hide":O.css("display","none");break;default:a=l.offset(),O.css({top:a.top,left:a.left,display:"block"})}}},A=function(b,d,h){if(c.isArray(a.settings.direction)||0!==m(a.settings.direction)){var e=m(B(b,"undefined"!=typeof d?t(d,2):"","undefined"!=typeof h?t(h,2):"")),g=(e+"").length;if(8==g&&("undefined"!=typeof q&&e<m(B(o,t(n,2),t(u,2)))||"undefined"!=typeof r&&e>m(B(J,t(L,2),t(P,2))))||6==g&&("undefined"!=typeof q&&e<m(B(o,t(n,2)))||"undefined"!= typeof r&&e>m(B(J,t(L,2))))||4==g&&("undefined"!=typeof q&&e<o||"undefined"!=typeof r&&e>J))return!0}if(S){"undefined"!=typeof d&&(d+=1);var i=!1;c.each(S,function(){if(!i&&(-1<c.inArray(b,this[2])||-1<c.inArray("*",this[2])))if("undefined"!=typeof d&&-1<c.inArray(d,this[1])||-1<c.inArray("*",this[1]))if("undefined"!=typeof h&&-1<c.inArray(h,this[0])||-1<c.inArray("*",this[0])){if("*"==this[3])return i=!0;var a=(new Date(b,d-1,h)).getDay();if(-1<c.inArray(a,this[3]))return i=!0}});if(i)return!0}return!1}, M=function(a){return(a+"").match(/^\-?[0-9]+$/)?!0:!1},V=function(b){c(".dp_caption",x).html(b);if(c.isArray(a.settings.direction)||0!==m(a.settings.direction)){var b=i,d=p,h,e;"days"==s?(e=0>d-1?B(b-1,"11"):B(b,t(d-1,2)),h=11<d+1?B(b+1,"00"):B(b,t(d+1,2))):"months"==s?(e=b-1,h=b+1):"years"==s&&(e=b-7,h=b+7);A(e)?(c(".dp_previous",x).addClass("dp_blocked"),c(".dp_previous",x).removeClass("dp_hover")):c(".dp_previous",x).removeClass("dp_blocked");A(h)?(c(".dp_next",x).addClass("dp_blocked"),c(".dp_next", x).removeClass("dp_hover")):c(".dp_next",x).removeClass("dp_blocked")}},K=function(){if(""==z.text()||"days"==s){if(""==z.text()){a.settings.always_visible||l.css("left",-1E3);l.css({display:"block"});ba();var b=z.outerWidth(),d=z.outerHeight();x.css("width",b);D.css({width:b,height:d});E.css({width:b,height:d});G.css("width",b);l.css({display:"none"})}else ba();D.css("display","none");E.css("display","none")}else if("months"==s){V(i);b="<tr>";for(d=0;12>d;d++){0<d&&0==d%3&&(b+="</tr><tr>");var h= "dp_month_"+d;A(i,d)?h+=" dp_disabled":!1!==H&&H==d?h+=" dp_selected":T==d&&R==i&&(h+=" dp_current");b+='<td class="'+c.trim(h)+'">'+a.settings.months[d].substr(0,3)+"</td>"}D.html(c(b+"</tr>"));a.settings.always_visible&&(Y=c("td:not(.dp_disabled)",D));D.css("display","");z.css("display","none");E.css("display","none")}else if("years"==s){V(i-7+" - "+(i+4));b="<tr>";for(d=0;12>d;d++)0<d&&0==d%3&&(b+="</tr><tr>"),h="",A(i-7+d)?h+=" dp_disabled":I&&I==i-7+d?h+=" dp_selected":R==i-7+d&&(h+=" dp_current"), b+="<td"+(""!=c.trim(h)?' class="'+c.trim(h)+'"':"")+">"+(i-7+d)+"</td>";E.html(c(b+"</tr>"));a.settings.always_visible&&(Z=c("td:not(.dp_disabled)",E));E.css("display","");z.css("display","none");D.css("display","none")}(a.settings.always_show_clear||a.settings.always_visible||""!=v.val())&&"block"!=G.css("display")?G.css("display",""):G.css("display","none")},U=function(b,c,h,e,g){var k=new Date(b,c,h),e="days"==e?X:"months"==e?Y:Z,f;f="";for(var j=k.getDate(),l=k.getDay(),m=a.settings.days[l], n=k.getMonth()+1,o=a.settings.months[n-1],q=k.getFullYear()+"",r=0;r<a.settings.format.length;r++){var s=a.settings.format.charAt(r);switch(s){case "y":q=q.substr(2);case "Y":f+=q;break;case "m":n=t(n,2);case "n":f+=n;break;case "M":o=o.substr(0,3);case "F":f+=o;break;case "d":j=t(j,2);case "j":f+=j;break;case "D":m=m.substr(0,3);case "l":f+=m;break;case "N":l++;case "w":f+=l;break;case "S":f=1==j%10&&"11"!=j?f+"st":2==j%10&&"12"!=j?f+"nd":3==j%10&&"13"!=j?f+"rd":f+"th";break;default:f+=s}}v.val(f); a.settings.always_visible&&(H=k.getMonth(),p=k.getMonth(),I=k.getFullYear(),i=k.getFullYear(),N=k.getDate(),e.removeClass("dp_selected"),g.addClass("dp_selected"));a.hide();a.settings.pair&&(a.settings.pair.data&&a.settings.pair.data("Zebra_DatePicker"))&&(g=a.settings.pair.data("Zebra_DatePicker"),g.update({reference_date:k}),g.settings.always_visible&&g.show());if(a.settings.onSelect&&"function"==typeof a.settings.onSelect)a.settings.onSelect(f,b+"-"+t(c+1,2)+"-"+t(h,2),new Date(b,c,h))},B=function(){for(var a= "",c=0;c<arguments.length;c++)a+=arguments[c]+"";return a},t=function(a,c){for(a+="";a.length<c;)a="0"+a;return a},m=function(a){return parseInt(a,10)};a._keyup=function(b){("block"==l.css("display")||27==b.which)&&a.hide();return!0};a._mousedown=function(b){if("block"==l.css("display")){if(c(b.target).get(0)===w.get(0))return!0;0==c(b.target).parents().filter(".Zebra_DatePicker").length&&a.hide()}return!0};$()};c.fn.Zebra_DatePicker=function(F){return this.each(function(){if(void 0!=c(this).data("Zebra_DatePicker")){var C= c(this).data("Zebra_DatePicker");C.icon.remove();C.datepicker.remove();c(document).unbind("keyup",C._keyup);c(document).unbind("mousedown",C._mousedown)}C=new c.Zebra_DatePicker(this,F);c(this).data("Zebra_DatePicker",C)})}})(jQuery);